#!/bin/sh

set -e

python=python3
${python} -c 'import sys; sys.exit(sys.version_info.major<3)'
${python} -c 'import sys; sys.exit(sys.version_info.minor<8)'

relpath() { python -c "import os; print(os.path.relpath('$1', '$2'))"; }

root=$(dirname $(realpath $0))/..
venv=${1:-${root}/venv}
test -d ${venv} || ${python} -m venv ${venv}
. ${venv}/bin/activate
python -m pip install wheel pyyaml scapy netifaces uvloop

site=$(python -c 'import site; _,=site.getsitepackages(); print(_)')
ln -sf $(relpath ${root}/lib/rcra ${site}) ${site}
